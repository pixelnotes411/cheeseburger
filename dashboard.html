async function confirmUrl() {
  const url = document.getElementById('urlInput').value.trim();
  const booking = document.getElementById('bookingLinkInput').value.trim();

  if (!url || !booking) {
    alert('Please enter both your website URL and booking link.');
    return;
  }

  const { data: { user }, error: userError } = await supabase.auth.getUser();
  if (userError || !user) {
    alert('User not found. Please log in again.');
    console.error('Auth error:', userError);
    return;
  }

  const userId = user.id;
  console.log("ðŸ‘¤ Authenticated user:", userId);

  const { data: existing, error: fetchError } = await supabase
    .from('chatbots')
    .select('id')
    .eq('user_id', userId)
    .maybeSingle();

  if (fetchError) {
    alert('Error checking chatbot: ' + fetchError.message);
    console.error('Fetch error:', fetchError);
    return;
  }

  if (existing) {
    const { error: updateError } = await supabase
      .from('chatbots')
      .update({ url, booking_link: booking })
      .eq('user_id', userId);

    if (updateError) {
      alert('Failed to update chatbot info: ' + updateError.message);
      console.error('Update error:', updateError);
      return;
    }
    console.log("âœ… Existing chatbot updated.");
  } else {
    const { error: insertError } = await supabase
      .from('chatbots')
      .insert([{ url, booking_link: booking, user_id: userId }]);

    if (insertError) {
      alert('Failed to insert chatbot info: ' + insertError.message);
      console.error('Insert error:', insertError);
      return;
    }
    console.log("âœ… New chatbot row inserted.");
  }

  try {
    const response = await fetch(`${SUPABASE_URL}/functions/v1/generate-bot`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ user_id: userId, url, booking })
    });

    const result = await response.json();
    console.log("ðŸ¤– Bot generation response:", result);

    if (result.success) {
      window.location.href = "/cheeseburger-loading.html";
    } else {
      alert('Bot generation failed: ' + (result.error || 'Unknown error'));
    }
  } catch (e) {
    alert('Error contacting bot generator. See console.');
    console.error('Fetch exception:', e);
  }
}









